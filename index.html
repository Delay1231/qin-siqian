<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <title>ç§¦å¸åƒï½œæ˜“çƒŠåƒçºäº’åŠ¨å°ç«™</title>
  <meta name="description" content="ç§¦å¸åƒï¼šä¸€ä¸ªè½»é‡ã€å¥½ç©ã€å¯äº’åŠ¨çš„æ˜“çƒŠåƒçºä¸»é¢˜å°ç«™ï¼ˆå°å¡ã€ç…§ç‰‡å¢™ã€å°æ¸¸æˆã€ç•™è¨€å¢™ï¼‰ã€‚å•æ–‡ä»¶ç¦»çº¿å¯ç”¨ã€‚" />

  <style>
    :root{
      --bg: #0b0f17;
      --bg2:#0f172a;
      --card:#0f172a;
      --card2:#111c33;
      --text:#e5e7eb;
      --muted:#a7b0c0;
      --line: rgba(255,255,255,.10);
      --brand:#7c3aed;
      --brand2:#22c55e;
      --shadow: 0 18px 50px rgba(0,0,0,.35);
      --r: 18px;
      --r2: 24px;
      --pad: 18px;
      --max: 1100px;
      --focus: 0 0 0 3px rgba(124, 58, 237, .35);
    }
    [data-theme="light"]{
      --bg:#f6f7fb;
      --bg2:#ffffff;
      --card:#ffffff;
      --card2:#ffffff;
      --text:#0f172a;
      --muted:#5b6476;
      --line: rgba(15,23,42,.12);
      --shadow: 0 18px 45px rgba(15,23,42,.12);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "PingFang SC","Noto Sans CJK SC","Microsoft YaHei", Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 15% 0%, rgba(124,58,237,.35), transparent 60%),
                  radial-gradient(1000px 500px at 80% 20%, rgba(34,197,94,.22), transparent 55%),
                  linear-gradient(180deg, var(--bg), var(--bg2));
      color:var(--text);
      overflow-x:hidden;
    }
    a{color:inherit}
    .wrap{max-width:var(--max); margin:0 auto; padding:0 18px}
    .topbar{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(10px);
      background: color-mix(in srgb, var(--bg2) 70%, transparent);
      border-bottom: 1px solid var(--line);
    }
    .topbar .inner{
      display:flex; align-items:center; justify-content:space-between;
      padding: 12px 0;
      gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px; text-decoration:none;
    }
    .logo{
      width:36px; height:36px; border-radius:12px;
      background: conic-gradient(from 180deg, var(--brand), var(--brand2), var(--brand));
      box-shadow: 0 10px 22px rgba(124,58,237,.22);
    }
    .brand strong{font-size:16px; letter-spacing:.5px}
    .brand small{display:block; color:var(--muted); font-size:12px; margin-top:2px}
    nav{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      justify-content:flex-end;
    }
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 11px;
      border:1px solid var(--line);
      border-radius:999px;
      background: color-mix(in srgb, var(--card) 84%, transparent);
      text-decoration:none;
      font-size:13px;
      color:var(--muted);
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    .chip:hover{transform: translateY(-1px); border-color: color-mix(in srgb, var(--brand) 45%, var(--line)); color:var(--text)}
    .chip:focus{outline:none; box-shadow: var(--focus)}
    .chip.primary{
      color: var(--text);
      border-color: color-mix(in srgb, var(--brand) 50%, var(--line));
      background: linear-gradient(180deg, color-mix(in srgb, var(--brand) 22%, var(--card)), color-mix(in srgb, var(--brand) 10%, var(--card)));
    }
    .hero{
      padding: 24px 0 10px;
    }
    .heroGrid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 18px;
      align-items:stretch;
    }
    @media (max-width: 920px){
      .heroGrid{grid-template-columns:1fr; }
    }
    .panel{
      border:1px solid var(--line);
      border-radius: var(--r2);
      background: linear-gradient(180deg, color-mix(in srgb, var(--card) 85%, transparent), color-mix(in srgb, var(--card2) 95%, transparent));
      box-shadow: var(--shadow);
    }
    .panel.padded{padding: 20px}
    .kicker{
      display:inline-flex; align-items:center; gap:8px;
      font-size: 12px; color: var(--muted);
      border: 1px dashed color-mix(in srgb, var(--brand) 35%, var(--line));
      padding: 7px 10px;
      border-radius: 999px;
      width: fit-content;
      background: color-mix(in srgb, var(--card) 82%, transparent);
    }
    h1{
      margin: 12px 0 10px;
      font-size: clamp(28px, 4vw, 40px);
      line-height:1.08;
      letter-spacing: .4px;
    }
    .sub{
      color: var(--muted);
      font-size: 15px;
      line-height: 1.65;
      margin: 0 0 14px;
    }
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      padding: 10px 14px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: color-mix(in srgb, var(--card) 86%, transparent);
      color: var(--text);
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      font-size: 14px;
    }
    .btn:hover{transform: translateY(-1px); border-color: color-mix(in srgb, var(--brand) 45%, var(--line))}
    .btn:focus{outline:none; box-shadow: var(--focus)}
    .btn.primary{
      border-color: color-mix(in srgb, var(--brand) 55%, var(--line));
      background: linear-gradient(180deg, color-mix(in srgb, var(--brand) 28%, var(--card)), color-mix(in srgb, var(--brand) 10%, var(--card)));
    }
    .btn.good{
      border-color: color-mix(in srgb, var(--brand2) 55%, var(--line));
      background: linear-gradient(180deg, color-mix(in srgb, var(--brand2) 22%, var(--card)), color-mix(in srgb, var(--brand2) 10%, var(--card)));
    }
    .stats{
      display:flex; gap:12px; flex-wrap:wrap; margin-top: 14px;
      color: var(--muted); font-size: 13px;
    }
    .stat{
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: color-mix(in srgb, var(--card) 90%, transparent);
    }
    .photoHero{
      overflow:hidden;
      position:relative;
      min-height: 260px;
      border-radius: var(--r2);
    }
    .photoHero img{
      width:100%; height:100%; object-fit:cover; display:block;
      filter: saturate(1.08) contrast(1.05);
      transform: scale(1.02);
    }
    .photoHero::after{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(180deg, rgba(0,0,0,.0), rgba(0,0,0,.45));
    }
    .photoBadge{
      position:absolute; left:14px; bottom:14px;
      display:flex; flex-direction:column; gap:6px;
      padding: 10px 12px;
      border:1px solid rgba(255,255,255,.18);
      border-radius: 16px;
      background: rgba(0,0,0,.28);
      color: #fff;
      backdrop-filter: blur(8px);
      max-width: 90%;
    }
    .photoBadge b{font-size: 13px}
    .photoBadge span{font-size:12px; opacity:.86; line-height:1.3}
    section{padding: 22px 0}
    .sectionTitle{
      display:flex; align-items:flex-end; justify-content:space-between;
      gap: 12px;
      margin-bottom: 12px;
    }
    .sectionTitle h2{
      margin:0;
      font-size: 20px;
      letter-spacing:.2px;
    }
    .sectionTitle p{
      margin:0;
      color: var(--muted);
      font-size: 13px;
    }
    .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 14px;
    }
    .card{
      border:1px solid var(--line);
      border-radius: var(--r);
      background: linear-gradient(180deg, color-mix(in srgb, var(--card) 92%, transparent), color-mix(in srgb, var(--card2) 98%, transparent));
      box-shadow: 0 10px 30px rgba(0,0,0,.12);
      overflow:hidden;
    }
    .card .hd{padding: 14px 14px 10px}
    .card .hd h3{margin:0 0 6px; font-size: 16px}
    .card .hd .muted{color:var(--muted); font-size:13px; line-height:1.55}
    .card .bd{padding: 0 14px 14px}
    .span-6{grid-column: span 6}
    .span-4{grid-column: span 4}
    .span-8{grid-column: span 8}
    .span-12{grid-column: span 12}
    @media (max-width: 900px){
      .span-6,.span-4,.span-8{grid-column: span 12}
    }

    /* photo wall */
    .photoGrid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 12px;
    }
    .pItem{
      grid-column: span 4;
      border-radius: var(--r);
      overflow:hidden;
      border: 1px solid var(--line);
      background: color-mix(in srgb, var(--card) 92%, transparent);
      cursor:pointer;
      position:relative;
      min-height: 170px;
    }
    .pItem img{width:100%; height:100%; object-fit:cover; display:block; transition: transform .18s ease}
    .pItem:hover img{transform: scale(1.04)}
    .pCap{
      position:absolute; inset:auto 10px 10px 10px;
      padding: 9px 10px;
      border-radius: 14px;
      background: rgba(0,0,0,.28);
      color:#fff;
      backdrop-filter: blur(8px);
      border:1px solid rgba(255,255,255,.14);
      font-size: 12px;
      line-height:1.3;
    }
    @media (max-width: 900px){ .pItem{grid-column: span 6} }
    @media (max-width: 520px){ .pItem{grid-column: span 12} }

    /* mini-cards */
    .miniCards{
      display:grid;
      grid-template-columns: repeat(12,1fr);
      gap: 12px;
    }
    .mCard{
      grid-column: span 4;
      border:1px solid var(--line);
      border-radius: var(--r);
      overflow:hidden;
      background: linear-gradient(180deg, color-mix(in srgb, var(--card) 92%, transparent), color-mix(in srgb, var(--card2) 98%, transparent));
      cursor:pointer;
      position:relative;
      transition: transform .12s ease, border-color .12s ease;
    }
    .mCard:hover{transform: translateY(-2px); border-color: color-mix(in srgb, var(--brand) 40%, var(--line))}
    .mImg{height: 150px; background:#111; overflow:hidden}
    .mImg img{width:100%; height:100%; object-fit:cover; display:block; filter:saturate(1.05) contrast(1.05)}
    .mBody{padding: 12px 12px 14px}
    .mTitle{display:flex; align-items:center; justify-content:space-between; gap:8px}
    .mTitle b{font-size: 15px}
    .mTag{
      font-size: 12px; color: var(--muted);
      border:1px solid var(--line);
      padding: 5px 8px;
      border-radius: 999px;
      background: color-mix(in srgb, var(--card) 92%, transparent);
      white-space:nowrap;
    }
    .mDesc{margin-top: 8px; font-size: 13px; color: var(--muted); line-height: 1.55}
    @media (max-width: 900px){ .mCard{grid-column: span 6} }
    @media (max-width: 520px){ .mCard{grid-column: span 12} }

    /* message wall */
    .formRow{display:flex; gap:10px; flex-wrap:wrap}
    input, textarea{
      width:100%;
      border:1px solid var(--line);
      border-radius: 14px;
      padding: 10px 12px;
      background: color-mix(in srgb, var(--card) 92%, transparent);
      color: var(--text);
      outline:none;
      font-size: 14px;
    }
    input:focus, textarea:focus{box-shadow: var(--focus); border-color: color-mix(in srgb, var(--brand) 45%, var(--line))}
    textarea{min-height: 90px; resize: vertical}
    .msgList{display:flex; flex-direction:column; gap:10px; margin-top: 12px}
    .msg{
      border:1px solid var(--line);
      border-radius: var(--r);
      padding: 12px 12px;
      background: color-mix(in srgb, var(--card) 92%, transparent);
    }
    .msgTop{display:flex; justify-content:space-between; gap:10px; align-items:center; margin-bottom: 8px}
    .msgName{font-weight:700; font-size: 13px}
    .msgTime{color: var(--muted); font-size: 12px}
    .msgText{color: var(--text); font-size: 14px; line-height:1.6; white-space:pre-wrap}
    .msgActions{display:flex; gap:8px; margin-top: 10px; flex-wrap:wrap}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: color-mix(in srgb, var(--card) 92%, transparent);
      color: var(--muted);
      cursor:pointer;
      font-size: 13px;
    }
    .pill:hover{color: var(--text); border-color: color-mix(in srgb, var(--brand) 35%, var(--line))}
    footer{
      padding: 26px 0 40px;
      color: var(--muted);
      font-size: 12px;
      border-top: 1px solid var(--line);
      margin-top: 10px;
    }
    .credits{
      display:flex; flex-direction:column; gap:8px;
      margin-top: 10px;
    }
    .credits a{color: color-mix(in srgb, var(--brand) 75%, var(--text)); text-decoration:none}
    .credits a:hover{text-decoration:underline}

    /* modal */
    .modalBack{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 100;
    }
    .modalBack.show{display:flex}
    .modal{
      width:min(960px, 100%);
      border-radius: 22px;
      border: 1px solid var(--line);
      background: color-mix(in srgb, var(--card) 95%, transparent);
      box-shadow: var(--shadow);
      overflow:hidden;
      max-height: 86vh;
      display:flex;
      flex-direction:column;
    }
    .modalTop{
      display:flex; align-items:center; justify-content:space-between;
      padding: 12px 14px;
      border-bottom: 1px solid var(--line);
      background: color-mix(in srgb, var(--card) 96%, transparent);
    }
    .modalTop b{font-size: 14px}
    .modalClose{
      width:38px; height:38px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: color-mix(in srgb, var(--card) 92%, transparent);
      cursor:pointer;
      color: var(--muted);
    }
    .modalClose:hover{color: var(--text); border-color: color-mix(in srgb, var(--brand) 35%, var(--line))}
    .modalBody{
      padding: 14px;
      overflow:auto;
    }

    /* confetti */
    .confetti{
      position:fixed; inset:0;
      pointer-events:none;
      overflow:hidden;
      z-index: 120;
      display:none;
    }
    .confetti.show{display:block}
    .c{
      position:absolute;
      width:10px; height:14px;
      border-radius:3px;
      opacity:.95;
      animation: fall linear forwards;
    }
    @keyframes fall{
      from{transform: translate3d(var(--x), -12vh, 0) rotate(0deg)}
      to{transform: translate3d(var(--x2), 110vh, 0) rotate(540deg)}
    }

    /* reduced motion */
    @media (prefers-reduced-motion: reduce){
      *{animation-duration:0.001ms !important; animation-iteration-count:1 !important; transition-duration:0.001ms !important; scroll-behavior:auto !important}
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="wrap">
      <div class="inner">
        <a class="brand" href="#top" aria-label="å›åˆ°é¡¶éƒ¨">
          <div class="logo" aria-hidden="true"></div>
          <div>
            <strong>ç§¦å¸åƒ</strong>
            <small>æ˜“çƒŠåƒçºäº’åŠ¨å°ç«™ï¼ˆç¦»çº¿å•é¡µï¼‰</small>
          </div>
        </a>
        <nav aria-label="ç«™å†…å¯¼èˆª">
          <a class="chip" href="#photos">ç…§ç‰‡å¢™</a>
          <a class="chip" href="#cards">äººç‰©å°å¡</a>
          <a class="chip" href="#games">å°æ¸¸æˆ</a>
          <a class="chip" href="#wall">ç•™è¨€å¢™</a>
          <button class="chip primary" id="themeBtn" type="button">ğŸŒ“ ä¸»é¢˜</button>
        </nav>
      </div>
    </div>
  </div>

  <main id="top">
    <header class="hero">
      <div class="wrap heroGrid">
        <div class="panel padded">
          <div class="kicker">âœ¨ ç§¦å¸åƒ Â· äº’åŠ¨å…¥å£</div>
          <h1>æŠŠâ€œå–œæ¬¢â€åšæˆå°æ¸¸æˆï¼š<br/>ä¸€é”®æŠ½å¡ã€ç‚¹äº®æ”¶è—ã€è§£é”å½©è›‹</h1>
          <p class="sub">
            è¿™é‡Œæ˜¯ä¸€ä¸ªåâ€œå¨±ä¹å‘â€çš„æ˜“çƒŠåƒçºä¸»é¢˜å°ç«™ï¼šä½ å¯ä»¥æµè§ˆç…§ç‰‡ã€ç‚¹å‡»äººç‰©å°å¡ã€æŠ½å¡æ”¶è—ã€åšä¸ªå°æµ‹éªŒï¼Œ
            ä¹Ÿå¯ä»¥åœ¨ç•™è¨€å¢™ç•™ä¸‹ä½ çš„è¯ï¼ˆä»…ä¿å­˜åœ¨æœ¬åœ°æµè§ˆå™¨ï¼‰ã€‚
          </p>

          <div class="row">
            <button class="btn primary" id="drawBtn" type="button">ğŸ´ ç«‹å³æŠ½ä¸€å¼ å°å¡</button>
            <button class="btn good" id="confettiBtn" type="button">ğŸ‰ æ”¾ä¸ªå°çƒŸèŠ±</button>
            <a class="btn" href="#cards">ğŸ‘‰ å»çœ‹å°å¡</a>
            <a class="btn" href="#photos">ğŸ–¼ï¸ çœ‹ç…§ç‰‡</a>
          </div>

          <div class="stats" id="quickStats">
            <div class="stat">ğŸ’ æˆ‘çš„å¡å†Œï¼š<b id="colCount">0</b> å¼ </div>
            <div class="stat">â¤ï¸ æ€»ç‚¹èµï¼š<b id="likeCount">0</b></div>
            <div class="stat">ğŸ•¹ï¸ å°æ¸¸æˆè®°å½•ï¼š<b id="gameBest">-</b></div>
          </div>
        </div>

        <div class="panel photoHero" aria-label="å°é¢ç…§ç‰‡">
          <img id="heroImg" alt="æ˜“çƒŠåƒçºç…§ç‰‡" loading="lazy" />
          <div class="photoBadge">
            <b id="heroTitle">ç…§ç‰‡åŠ è½½ä¸­â€¦</b>
            <span id="heroCredit"></span>
          </div>
        </div>
      </div>
    </header>

    <section id="photos">
      <div class="wrap">
        <div class="sectionTitle">
          <div>
            <h2>ç…§ç‰‡å¢™</h2>
            <p>ç‚¹å¼€æŸ¥çœ‹å¤§å›¾ä¸æ¥æºï¼ˆå›¾ç‰‡æ¥è‡ª Wikimedia Commonsï¼Œéƒ¨åˆ†ä¸º CC BY-SA 4.0ï¼‰ã€‚</p>
          </div>
          <div class="row">
            <button class="btn" id="shufflePhotosBtn" type="button">ğŸ”€ éšæœºæ’åº</button>
            <button class="btn" id="openHeroBtn" type="button">ğŸ” æŸ¥çœ‹å°é¢å›¾</button>
          </div>
        </div>

        <div class="photoGrid" id="photoGrid" aria-label="ç…§ç‰‡åˆ—è¡¨"></div>
      </div>
    </section>

    <section id="cards">
      <div class="wrap">
        <div class="sectionTitle">
          <div>
            <h2>äººç‰©å°å¡</h2>
            <p>æ›´è½»ã€æ›´å¥½ç‚¹ï¼šç‚¹å‡»å¡ç‰‡â†’çœ‹å†…å®¹â†’ç‚¹èµ/æ”¶è—â†’è§£é”å½©è›‹ã€‚</p>
          </div>
          <div class="row">
            <button class="btn primary" id="drawBtn2" type="button">ğŸ´ å†æŠ½ä¸€å¼ </button>
            <button class="btn" id="openAlbumBtn" type="button">ğŸ“š æ‰“å¼€æˆ‘çš„å¡å†Œ</button>
            <button class="btn" id="clearAlbumBtn" type="button" title="åªæ¸…ç©ºæ”¶è—ï¼Œä¸å½±å“ç•™è¨€">ğŸ§¹ æ¸…ç©ºæ”¶è—</button>
          </div>
        </div>

        <div class="miniCards" id="miniCards" aria-label="å°å¡åˆ—è¡¨"></div>

        <div class="grid" style="margin-top:14px">
          <div class="card span-12">
            <div class="hd">
              <h3>ä»£è¡¨ä½œå“ï¼ˆä»…åˆ—å°‘é‡ï¼‰</h3>
              <div class="muted">ä¸ºäº†é¿å…â€œä½œå“åˆ·å±â€ï¼Œè¿™é‡Œåªç•™ 3 ä¸ªå ä½ç¤ºä¾‹ï¼›ä½ è¦æˆ‘æ¢æˆä½ æƒ³è¦çš„å…·ä½“æ¸…å•ä¹Ÿè¡Œã€‚</div>
            </div>
            <div class="bd">
              <div class="row" style="gap:8px">
                <span class="chip" style="pointer-events:none">ğŸ¬ ç”µå½±ï¼šå°‘é‡å±•ç¤º</span>
                <span class="chip" style="pointer-events:none">ğŸ“º ç»¼è‰ºï¼šå°‘é‡å±•ç¤º</span>
                <span class="chip" style="pointer-events:none">ğŸµ éŸ³ä¹ï¼šå°‘é‡å±•ç¤º</span>
              </div>
              <ul style="margin:10px 0 0; padding-left: 18px; color: var(--muted); line-height:1.7">
                <li>ç”µå½±/è§’è‰²ï¼šä½ æŒ‡å®šä¸€ä¸ªï¼Œæˆ‘å°±æŠŠâ€œå¡ç‰‡å†…å®¹â€åšæˆæ›´æœ‰æ¢—çš„äº’åŠ¨ã€‚</li>
                <li>èˆå°/æ¼”å‡ºï¼šå¯ä»¥åšæˆâ€œèŠ‚å¥æŒ‰é”®â€å°æ¸¸æˆã€‚</li>
                <li>æ­Œæ›²/ä¸“è¾‘ï¼šå¯ä»¥åšæˆâ€œå¬å‰å¥çŒœæ­Œâ€ï¼ˆæœ¬åœ°éŸ³é¢‘ä¹Ÿæ”¯æŒï¼‰ã€‚</li>
              </ul>
            </div>
          </div>
        </div>

      </div>
    </section>

    <section id="games">
      <div class="wrap">
        <div class="sectionTitle">
          <div>
            <h2>å°æ¸¸æˆ</h2>
            <p>è½»é‡ä¸¤é¡¹ï¼šå°æµ‹éªŒ + è®°å¿†ç¿»ç‰Œï¼ˆéƒ½åªåœ¨æœ¬åœ°å­˜å‚¨ï¼‰ã€‚</p>
          </div>
          <div class="row">
            <button class="btn" id="resetGamesBtn" type="button">â™»ï¸ é‡ç½®è®°å½•</button>
          </div>
        </div>

        <div class="grid">
          <div class="card span-6">
            <div class="hd">
              <h3>ğŸ¯ 3 é¢˜å°æµ‹éªŒ</h3>
              <div class="muted">åå¨±ä¹ï¼šç­”å®Œç»™ä½ ä¸€ä¸ªâ€œç§°å·â€ã€‚</div>
            </div>
            <div class="bd" id="quiz"></div>
          </div>

          <div class="card span-6">
            <div class="hd">
              <h3>ğŸ§  è®°å¿†ç¿»ç‰Œ</h3>
              <div class="muted">ç”¨ç…§ç‰‡åšå¡é¢ï¼šåŒ¹é…å®Œæˆè¶Šå¿«è¶Šå¥½ã€‚</div>
            </div>
            <div class="bd">
              <div class="row" style="margin-bottom:10px">
                <button class="btn primary" id="startMemBtn" type="button">å¼€å§‹</button>
                <button class="btn" id="restartMemBtn" type="button">é‡æ¥</button>
                <span class="chip" style="pointer-events:none">â±ï¸ <b id="memTime">0.0</b>s</span>
                <span class="chip" style="pointer-events:none">âœ… <b id="memMatch">0</b>/6</span>
              </div>
              <div class="grid" id="memGrid" style="gap:10px"></div>
              <div class="sub" style="margin-top:10px">æç¤ºï¼šç‚¹ä¸¤å¼ å¡ï¼Œè‹¥ç›¸åŒåˆ™ä¿ç•™ï¼›å…¨éƒ¨åŒ¹é…ä¼šè‡ªåŠ¨æ”¾å½©çº¸ã€‚</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="wall">
      <div class="wrap">
        <div class="sectionTitle">
          <div>
            <h2>ç•™è¨€å¢™</h2>
            <p>ä½ çš„ç•™è¨€åªä¿å­˜åœ¨æœ¬æœºæµè§ˆå™¨ï¼ˆlocalStorageï¼‰ï¼Œä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚</p>
          </div>
          <div class="row">
            <button class="btn" id="sortHotBtn" type="button">ğŸ”¥ çƒ­é—¨ä¼˜å…ˆ</button>
            <button class="btn" id="sortNewBtn" type="button">ğŸ•’ æœ€æ–°ä¼˜å…ˆ</button>
            <button class="btn" id="clearMsgBtn" type="button" title="æ¸…ç©ºæœ¬åœ°ç•™è¨€">ğŸ§¹ æ¸…ç©ºç•™è¨€</button>
          </div>
        </div>

        <div class="grid">
          <div class="card span-4">
            <div class="hd">
              <h3>å†™ä¸€æ¡</h3>
              <div class="muted">å¯ä»¥å†™ç¥ç¦ã€æ‰“å¡ã€æ¢—ã€æˆ–è€…ä½ æœ€æƒ³è¯´çš„ä¸€å¥è¯ã€‚</div>
            </div>
            <div class="bd">
              <div class="formRow">
                <input id="nameInput" placeholder="ç½²åï¼ˆå¯é€‰ï¼‰" maxlength="20" />
                <textarea id="msgInput" placeholder="ç•™è¨€å†…å®¹â€¦" maxlength="240"></textarea>
                <button class="btn primary" id="postBtn" type="button">å‘å¸ƒ</button>
                <button class="btn" id="randomPromptBtn" type="button">ğŸ² ç»™æˆ‘ä¸€ä¸ªè¯é¢˜</button>
              </div>
              <div class="sub" style="margin-top:10px">å°æé†’ï¼šæ–‡æ˜å‘è¨€ï¼Œåˆ«æ”¾éšç§ä¿¡æ¯ã€‚</div>
            </div>
          </div>

          <div class="card span-8">
            <div class="hd">
              <h3>å¤§å®¶çš„ç•™è¨€</h3>
              <div class="muted">æ”¯æŒç‚¹èµã€ç½®é¡¶ï¼ˆæœ¬åœ°ï¼‰ã€ä¸€é”®å¤åˆ¶ã€‚</div>
            </div>
            <div class="bd">
              <div class="msgList" id="msgList"></div>
              <div class="sub" id="emptyTip" style="display:none; margin-top:8px">è¿˜æ²¡æœ‰ç•™è¨€ï¼Œæ¥å½“ç¬¬ä¸€ä¸ªï¼</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <footer>
      <div class="wrap">
        <div>Â© ç§¦å¸åƒï½œå•æ–‡ä»¶ç¦»çº¿ç‰ˆã€‚ä½ å¯ä»¥ç›´æ¥æŠŠè¿™ä¸ª HTML ä¸¢åˆ°ä»»ä½•é™æ€æœåŠ¡å™¨ä¸Šä½¿ç”¨ã€‚</div>
        <div class="credits" id="credits"></div>
      </div>
    </footer>
  </main>

  <!-- Modal -->
  <div class="modalBack" id="modalBack" role="dialog" aria-modal="true" aria-label="å¼¹çª—">
    <div class="modal">
      <div class="modalTop">
        <b id="modalTitle">è¯¦æƒ…</b>
        <button class="modalClose" id="modalClose" aria-label="å…³é—­">âœ•</button>
      </div>
      <div class="modalBody" id="modalBody"></div>
    </div>
  </div>

  <!-- Confetti -->
  <div class="confetti" id="confetti" aria-hidden="true"></div>

<script>
/** ======================
 *  æ•°æ®ï¼šç…§ç‰‡ä¸å°å¡
 *  ====================== */
const PHOTOS = [
  {
    id: "p_2024_tiff",
    title: "ä¸œäº¬å›½é™…ç”µå½±èŠ‚ Â· 2024",
    img: "https://commons.wikimedia.org/wiki/Special:FilePath/2024%20Jackson%20Yee.jpg?width=1400",
    link: "https://commons.wikimedia.org/wiki/File:2024_Jackson_Yee.jpg",
    credit: "Siup00 / CC BY-SA 4.0"
  },
  {
    id: "p_2025_concert",
    title: "Que Xue Concert Â· 2025",
    img: "https://commons.wikimedia.org/wiki/Special:FilePath/Jackson%20Yee%20at%20Que%20Xue%20Concert%20in%202025.jpg?width=1400",
    link: "https://commons.wikimedia.org/wiki/File:Jackson_Yee_at_Que_Xue_Concert_in_2025.jpg",
    credit: "Siup00 / CC BY-SA 4.0"
  },
  {
    id: "p_singer_2018",
    title: "æ­Œæ‰‹å½¢è±¡ Â· 2018",
    img: "https://commons.wikimedia.org/wiki/Special:FilePath/%E6%AD%8C%E6%89%8B%E6%98%93%E7%83%8A%E5%8D%83%E7%8E%BA.jpg?width=1200",
    link: "https://commons.wikimedia.org/wiki/File:%E6%AD%8C%E6%89%8B%E6%98%93%E7%83%8A%E5%8D%83%E7%8E%BA.jpg",
    credit: "åˆ¹å¯‚_æ˜“çƒŠåƒçºä¸ªç«™ / CC BY-SA 4.0"
  },
  {
    id: "p_adidas_2020",
    title: "Adidas Â· 2020",
    img: "https://commons.wikimedia.org/wiki/Special:FilePath/%E6%98%93%E7%83%8A%E5%8D%83%E7%8E%BA%E9%98%BF%E8%BF%AA%E8%BE%BE%E6%96%AF.jpg?width=1200",
    link: "https://commons.wikimedia.org/wiki/File:%E6%98%93%E7%83%8A%E5%8D%83%E7%8E%BA%E9%98%BF%E8%BF%AA%E8%BE%BE%E6%96%AF.jpg",
    credit: "åˆ¹å¯‚_æ˜“çƒŠåƒçºä¸ªç«™ / CC BY-SA 4.0"
  },
  {
    id: "p_2019_suer",
    title: "Su Er Concert Â· 2019",
    img: "https://commons.wikimedia.org/wiki/Special:FilePath/2019%20Jackson%20Yee%20Concert.jpg?width=1400",
    link: "https://commons.wikimedia.org/wiki/File:2019_Jackson_Yee_Concert.jpg",
    credit: "Siup00 / CC BY-SA 4.0"
  },
  {
    id: "p_2019_cute",
    title: "æ¼”å”±ä¼šç…§ç‰‡ Â· 2019",
    img: "https://commons.wikimedia.org/wiki/Special:FilePath/%E6%98%93%E7%83%8A%E5%8D%83%E7%8E%BA_%E5%B8%85%E7%85%A7.jpg?width=1200",
    link: "https://commons.wikimedia.org/wiki/File:%E6%98%93%E7%83%8A%E5%8D%83%E7%8E%BA_%E5%B8%85%E7%85%A7.jpg",
    credit: "_SugarOrSalt_ / CC BY-SA 4.0"
  }
];

const CARDS = [
  {
    id:"c_stage",
    title:"èˆå°èƒ½é‡å¡",
    tag:"èŠ‚å¥",
    emoji:"ğŸ¤",
    photo:"p_2019_suer",
    desc:"ç‚¹æˆ‘çœ‹çœ‹â€œèŠ‚å¥æŒ‘æˆ˜â€ã€‚ä½ å¯ä»¥è·Ÿç€èŠ‚æ‹ç‚¹æŒ‰æŒ‰é’®ï¼Œè¿å‡»è¶Šå¤šè¶Šå¥½ï¼ˆçº¯å¨±ä¹ï¼‰ã€‚",
    actions:[
      {label:"â–¶ èŠ‚å¥å¼€åœº", type:"beat"},
      {label:"ğŸ² éšæœºæŒ‘æˆ˜", type:"prompt"}
    ]
  },
  {
    id:"c_film",
    title:"ç”µå½±è´¨æ„Ÿå¡",
    tag:"é•œå¤´",
    emoji:"ğŸ¬",
    photo:"p_2024_tiff",
    desc:"æŠŠâ€œç”µå½±æ„Ÿâ€åšæˆäº’åŠ¨ï¼šéšæœºç»™ä½ ä¸€ä¸ªé•œå¤´ä»»åŠ¡ï¼ˆæ¯”å¦‚ï¼šæ…¢èµ°ã€å›å¤´ã€å®šæ ¼ 2 ç§’ï¼‰ã€‚",
    actions:[
      {label:"ğŸï¸ æ¥ä¸ªé•œå¤´ä»»åŠ¡", type:"shot"},
      {label:"âœ¨ æ”¾å½©çº¸", type:"confetti"}
    ]
  },
  {
    id:"c_focus",
    title:"ä¸“æ³¨åŠ›å¡",
    tag:"åšæŒ",
    emoji:"ğŸ§ ",
    photo:"p_singer_2018",
    desc:"å°æ¸¸æˆå‘ï¼šç»™ä½ ä¸€ä¸ª 10 ç§’ä¸“æ³¨æŒ‘æˆ˜â€”â€”ç›¯ä½å°ç‚¹ç‚¹ä¸åˆ†ç¥ï¼ˆåˆ«çœ¨çœ¼å½“ç„¶ä¹Ÿè¡Œï¼‰ã€‚",
    actions:[
      {label:"ğŸŸ£ å¼€å§‹ä¸“æ³¨æŒ‘æˆ˜", type:"focus"},
      {label:"ğŸ§© ç¿»ç‰Œå»", type:"goto_mem"}
    ]
  },
  {
    id:"c_smile",
    title:"ç¬‘å®¹å½©è›‹å¡",
    tag:"å½©è›‹",
    emoji:"ğŸ˜„",
    photo:"p_2019_cute",
    desc:"è¿™å¼ å¡è—äº†å½©è›‹ï¼šè¿ç»­ç‚¹èµ 3 æ¬¡ï¼Œä¼šè§¦å‘ä¸€ä¸ªå°æƒŠå–œã€‚",
    actions:[
      {label:"â¤ï¸ è¿ç‚¹ç‚¹èµ", type:"triple_like"},
      {label:"ğŸ“Œ å¤åˆ¶ç¥ç¦è¯­", type:"copy_bless"}
    ]
  },
  {
    id:"c_style",
    title:"ç©¿æ­çµæ„Ÿå¡",
    tag:"é£æ ¼",
    emoji:"ğŸ§¥",
    photo:"p_adidas_2020",
    desc:"çº¯å¨±ä¹ç©¿æ­å±€ï¼šéšæœºç»™ä½  1 ä¸ªâ€œç©¿æ­å…³é”®è¯â€ï¼Œä½ å¯ä»¥å†™åœ¨ç•™è¨€å¢™é‡Œå½“æ‰“å¡ã€‚",
    actions:[
      {label:"ğŸ§· æŠ½ä¸€ä¸ªå…³é”®è¯", type:"style"},
      {label:"ğŸ“ å»ç•™è¨€å¢™", type:"goto_wall"}
    ]
  },
  {
    id:"c_random",
    title:"éšæœºå°å¡",
    tag:"ç›²ç›’",
    emoji:"ğŸ",
    photo:"p_2025_concert",
    desc:"ç›²ç›’å¡ï¼šä¼šéšæœºæ‰“å¼€å¦ä¸€å¼ å¡ï¼Œå¹¶é™„å¸¦ä¸€ä¸ªâ€œä»Šæ—¥å¥½è¿ç­¾â€ã€‚",
    actions:[
      {label:"ğŸ´ å†æŠ½ä¸€å¼ ", type:"draw"},
      {label:"ğŸ€ å¥½è¿ç­¾", type:"luck"}
    ]
  }
];

/** ======================
 *  æœ¬åœ°å­˜å‚¨
 *  ====================== */
const KEY = "QSQ_SITE_V1";
const state = loadState() || {
  theme: "dark",
  likes: {},        // per card id
  collected: [],    // card ids
  best: null,       // best memory time
  msgSort: "new",
  messages: [],     // {id,name,text,ts,likes,pin}
  streak: 0         // for easter egg
};

function save(){ localStorage.setItem(KEY, JSON.stringify(state)); }
function loadState(){
  try{ return JSON.parse(localStorage.getItem(KEY) || ""); }catch(e){ return null; }
}

/** ======================
 *  DOM helpers
 *  ====================== */
const $ = (s, el=document)=> el.querySelector(s);
const $$ = (s, el=document)=> Array.from(el.querySelectorAll(s));
const fmtTime = (ts)=> {
  const d = new Date(ts);
  const pad = (n)=> String(n).padStart(2,"0");
  return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
};
const escapeHtml = (str)=> str.replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[m]));

/** ======================
 *  Theme
 *  ====================== */
function applyTheme(){
  document.documentElement.dataset.theme = state.theme === "light" ? "light" : "dark";
}
$("#themeBtn").addEventListener("click", ()=>{
  state.theme = (state.theme === "light") ? "dark" : "light";
  save(); applyTheme();
});
applyTheme();

/** ======================
 *  Hero & credits
 *  ====================== */
let heroIndex = 0;
function setHero(i){
  heroIndex = ((i % PHOTOS.length) + PHOTOS.length) % PHOTOS.length;
  const p = PHOTOS[heroIndex];
  $("#heroImg").src = p.img;
  $("#heroTitle").textContent = p.title;
  $("#heroCredit").innerHTML = `æ¥æºï¼š<a href="${p.link}" target="_blank" rel="noreferrer" style="color:#fff; text-decoration:underline">${p.credit}</a>`;
}
setHero(0);

$("#openHeroBtn").addEventListener("click", ()=> openPhotoModal(PHOTOS[heroIndex]) );

function renderCredits(){
  const uniq = new Map();
  PHOTOS.forEach(p=> uniq.set(p.link, p));
  const lines = Array.from(uniq.values()).map(p=>{
    return `â€¢ <a href="${p.link}" target="_blank" rel="noreferrer">${p.title}</a>ï¼ˆ${p.credit}ï¼‰`;
  }).join("<br/>");
  $("#credits").innerHTML = `<div><b>å›¾ç‰‡è‡´è°¢ï¼š</b><br/>${lines}</div>
  <div>æç¤ºï¼šå³ä½¿å›¾ç‰‡åœ¨ Commons ä¸Šæ˜¯è‡ªç”±è®¸å¯ï¼Œäººç‰©çš„è‚–åƒæƒ/å®£ä¼ æƒä»å¯èƒ½å¯¹æŸäº›ç”¨é€”æœ‰é™åˆ¶ï¼›æœ¬é¡µä»…ä½œå­¦ä¹ ä¸å±•ç¤ºã€‚</div>`;
}
renderCredits();

/** ======================
 *  Photo wall
 *  ====================== */
function renderPhotos(list){
  const grid = $("#photoGrid");
  grid.innerHTML = "";
  list.forEach((p)=>{
    const div = document.createElement("div");
    div.className = "pItem";
    div.tabIndex = 0;
    div.innerHTML = `
      <img loading="lazy" alt="${escapeHtml(p.title)}" src="${p.img}">
      <div class="pCap"><b>${escapeHtml(p.title)}</b><br/><span style="opacity:.86">${escapeHtml(p.credit)}</span></div>
    `;
    div.addEventListener("click", ()=> openPhotoModal(p));
    div.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); openPhotoModal(p);} });
    grid.appendChild(div);
  });
}
renderPhotos(PHOTOS);

$("#shufflePhotosBtn").addEventListener("click", ()=>{
  const arr = [...PHOTOS].sort(()=> Math.random()-0.5);
  renderPhotos(arr);
});

/** ======================
 *  Modal
 *  ====================== */
const modalBack = $("#modalBack");
const modalBody = $("#modalBody");
const modalTitle = $("#modalTitle");
function openModal(title, html){
  modalTitle.textContent = title;
  modalBody.innerHTML = html;
  modalBack.classList.add("show");
  // focus for accessibility
  $("#modalClose").focus();
}
function closeModal(){ modalBack.classList.remove("show"); modalBody.innerHTML=""; }
$("#modalClose").addEventListener("click", closeModal);
modalBack.addEventListener("click", (e)=>{ if(e.target === modalBack) closeModal(); });
document.addEventListener("keydown", (e)=>{ if(e.key==="Escape" && modalBack.classList.contains("show")) closeModal(); });

function openPhotoModal(p){
  openModal("ç…§ç‰‡æŸ¥çœ‹", `
    <div style="display:grid; grid-template-columns: 1fr; gap:12px">
      <img alt="${escapeHtml(p.title)}" src="${p.img}" style="width:100%; border-radius:18px; border:1px solid var(--line); background:var(--bg2)" />
      <div class="row" style="justify-content:space-between; align-items:flex-start; gap:12px">
        <div>
          <div style="font-weight:800; font-size:16px">${escapeHtml(p.title)}</div>
          <div style="color:var(--muted); font-size:13px; margin-top:6px">å›¾ç‰‡æ¥æºï¼š${escapeHtml(p.credit)}</div>
        </div>
        <div class="row">
          <a class="btn" href="${p.link}" target="_blank" rel="noreferrer">æ‰“å¼€æ¥æº</a>
          <button class="btn primary" type="button" id="setAsHeroBtn">è®¾ä¸ºå°é¢</button>
        </div>
      </div>
    </div>
  `);
  setTimeout(()=>{
    const btn = $("#setAsHeroBtn");
    if(btn){
      btn.addEventListener("click", ()=>{
        const idx = PHOTOS.findIndex(x=>x.id===p.id);
        if(idx>=0) setHero(idx);
        closeModal();
      });
    }
  }, 0);
}

/** ======================
 *  Cards
 *  ====================== */
function cardLikes(id){ return state.likes[id] || 0; }
function isCollected(id){ return state.collected.includes(id); }

function renderQuickStats(){
  $("#colCount").textContent = state.collected.length;
  const totalLikes = Object.values(state.likes).reduce((a,b)=>a+(b||0), 0);
  $("#likeCount").textContent = totalLikes;
  $("#gameBest").textContent = state.best ? `${state.best.toFixed(1)}s` : "-";
}
renderQuickStats();

function renderCards(){
  const box = $("#miniCards");
  box.innerHTML = "";
  CARDS.forEach(c=>{
    const p = PHOTOS.find(x=>x.id===c.photo) || PHOTOS[0];
    const div = document.createElement("div");
    div.className = "mCard";
    div.tabIndex = 0;
    div.innerHTML = `
      <div class="mImg"><img loading="lazy" alt="${escapeHtml(c.title)}" src="${p.img}"></div>
      <div class="mBody">
        <div class="mTitle">
          <b>${c.emoji} ${escapeHtml(c.title)}</b>
          <span class="mTag">${escapeHtml(c.tag)} Â· â¤ï¸ ${cardLikes(c.id)}</span>
        </div>
        <div class="mDesc">${escapeHtml(c.desc)}</div>
        <div class="row" style="margin-top:10px">
          <span class="chip" style="pointer-events:none">${isCollected(c.id) ? "âœ… å·²æ”¶è—" : "â• å¯æ”¶è—"}</span>
          <span class="chip" style="pointer-events:none">ç‚¹å‡»å±•å¼€</span>
        </div>
      </div>
    `;
    div.addEventListener("click", ()=> openCard(c.id));
    div.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); openCard(c.id);} });
    box.appendChild(div);
  });
}
renderCards();

function openCard(cardId){
  const c = CARDS.find(x=>x.id===cardId);
  if(!c) return;
  const p = PHOTOS.find(x=>x.id===c.photo) || PHOTOS[0];

  const likeN = cardLikes(c.id);
  const collected = isCollected(c.id);

  const actionBtns = (c.actions || []).map((a,idx)=>`<button class="btn ${idx===0?'primary':''}" type="button" data-act="${a.type}">${escapeHtml(a.label)}</button>`).join("");

  openModal("äººç‰©å°å¡", `
    <div style="display:grid; grid-template-columns: 1fr; gap:12px">
      <img alt="${escapeHtml(c.title)}" src="${p.img}" style="width:100%; max-height:380px; object-fit:cover; border-radius:18px; border:1px solid var(--line)" />
      <div style="display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap; align-items:flex-start">
        <div>
          <div style="font-weight:900; font-size:18px">${c.emoji} ${escapeHtml(c.title)}</div>
          <div style="margin-top:6px; color:var(--muted); line-height:1.7">${escapeHtml(c.desc)}</div>
          <div class="row" style="margin-top:10px">
            <span class="chip" style="pointer-events:none">æ ‡ç­¾ï¼š${escapeHtml(c.tag)}</span>
            <span class="chip" style="pointer-events:none">â¤ï¸ ç‚¹èµï¼š<b id="cardLikeNum">${likeN}</b></span>
            <span class="chip" style="pointer-events:none">ğŸ’ ${collected ? "å·²åœ¨å¡å†Œ" : "æœªæ”¶è—"}</span>
          </div>
        </div>
        <div class="row" style="align-items:center">
          <button class="btn" type="button" id="likeCardBtn">â¤ï¸ ç‚¹èµ</button>
          <button class="btn good" type="button" id="collectCardBtn">${collected ? "âœ… å·²æ”¶è—" : "â• æ”¶è—"}</button>
          <button class="btn" type="button" id="nextCardBtn">ğŸ´ éšæœºä¸‹ä¸€å¼ </button>
        </div>
      </div>

      <div class="panel padded" style="padding:14px">
        <div style="font-weight:800; margin-bottom:10px">è¶£å‘³æŒ‰é’®</div>
        <div class="row" id="actionRow">${actionBtns}</div>
        <div class="sub" id="actionResult" style="margin-top:10px"></div>
        <div class="row" style="margin-top:8px">
          <a class="btn" href="${p.link}" target="_blank" rel="noreferrer">æŸ¥çœ‹å›¾ç‰‡æ¥æº</a>
        </div>
      </div>
    </div>
  `);

  setTimeout(()=>{
    const likeBtn = $("#likeCardBtn");
    const collectBtn = $("#collectCardBtn");
    const nextBtn = $("#nextCardBtn");
    const likeNum = $("#cardLikeNum");
    const res = $("#actionResult");
    const actionRow = $("#actionRow");

    likeBtn?.addEventListener("click", ()=>{
      state.likes[c.id] = (state.likes[c.id]||0) + 1;
      save();
      likeNum.textContent = state.likes[c.id];
      renderQuickStats();
      renderCards();

      // easter: for smile card, triple-like triggers
      if(c.id === "c_smile"){
        state.streak = (state.streak||0) + 1;
        if(state.streak >= 3){
          state.streak = 0;
          save();
          confetti();
          res.textContent = "å½©è›‹è§¦å‘ï¼šä½ ç‚¹äº®äº†â€œç¬‘å®¹å½©è›‹â€ğŸ‰";
        }else{
          save();
          res.textContent = `å½©è›‹è¿›åº¦ï¼š${state.streak}/3ï¼ˆå†ç‚¹å‡ æ¬¡è¯•è¯•ï¼‰`;
        }
      }else{
        state.streak = 0; save();
      }
    });

    collectBtn?.addEventListener("click", ()=>{
      if(!state.collected.includes(c.id)){
        state.collected.push(c.id);
        save();
        renderQuickStats();
        renderCards();
        collectBtn.textContent = "âœ… å·²æ”¶è—";
        res.textContent = "å·²åŠ å…¥ä½ çš„å¡å†Œï¼";
      }else{
        res.textContent = "å·²ç»åœ¨å¡å†Œé‡Œå•¦ï½";
      }
    });

    nextBtn?.addEventListener("click", ()=>{
      const next = CARDS[Math.floor(Math.random()*CARDS.length)];
      openCard(next.id);
    });

    actionRow?.addEventListener("click", (e)=>{
      const btn = e.target.closest("button[data-act]");
      if(!btn) return;
      const type = btn.getAttribute("data-act");
      handleAction(type, res);
    });
  },0);
}

function handleAction(type, resEl){
  const prompts = [
    "ç”¨ 7 ä¸ªå­—å½¢å®¹ä»Šå¤©çš„å¿ƒæƒ…ã€‚",
    "ç”¨ä¸€ä¸ªè¡¨æƒ…å†™ä¸€å¥ç¥ç¦ã€‚",
    "ç»™è‡ªå·±ä¸€ä¸ª 3 å¤©åå¯å®Œæˆçš„å°ç›®æ ‡ã€‚",
    "å†™ä¸€å¥â€œæˆ‘é€‰æ‹©åšæŒï¼Œå› ä¸ºâ€¦â€ã€‚",
    "ç”¨â€˜å…‰â€™é€ ä¸€ä¸ªå¥å­ã€‚"
  ];
  const shots = [
    "é•œå¤´ä»»åŠ¡ï¼šæ…¢æ…¢èµ°ä¸¤æ­¥ â†’ å›å¤´ â†’ å®šæ ¼ 2 ç§’ã€‚",
    "é•œå¤´ä»»åŠ¡ï¼šæŠ¬å¤´çœ‹è¿œå¤„ â†’ å¾®ç¬‘ â†’ è½»ç‚¹å¤´ã€‚",
    "é•œå¤´ä»»åŠ¡ï¼šæ‰‹æ’å£è¢‹ â†’ ä¾§èº« â†’ çœ¨çœ¼ç»“æŸã€‚",
    "é•œå¤´ä»»åŠ¡ï¼šå‘å·¦çœ‹ â†’ å‘å³çœ‹ â†’ é•œå¤´å¤–æŒ¥æ‰‹ã€‚"
  ];
  const styles = ["é»‘ç™½æç®€","è¿åŠ¨æœºèƒ½","å¤å¤ç‰›ä»”","å­¦é™¢é£","æ¸…çˆ½ç™½è¡¬è¡«","å†¬æ—¥å¤§è¡£","å¸½å­+è€³æœº","åŒè‰²ç³»å ç©¿"];
  const luck = ["ä»Šå¤©é€‚åˆåšä¸€ä»¶å°äº‹å¹¶æŠŠå®ƒåšå®Œã€‚","åˆ«æ€¥ï¼Œæ…¢ä¸€ç‚¹åè€Œæ›´ç¨³ã€‚","ç»™è‡ªå·±å¤šä¸€ç‚¹è‚¯å®šã€‚","æŠŠæ³¨æ„åŠ›æ”¾å›å½“ä¸‹ï¼Œä½ ä¼šæ›´å¼ºã€‚","å¥½è¿åœ¨è·¯ä¸Šï¼Œå…ˆèµ°èµ·æ¥ã€‚"];

  if(type==="prompt"){
    resEl.textContent = "æŒ‘æˆ˜é¢˜ï¼š" + prompts[Math.floor(Math.random()*prompts.length)];
  }else if(type==="shot"){
    resEl.textContent = shots[Math.floor(Math.random()*shots.length)];
  }else if(type==="style"){
    resEl.textContent = "ç©¿æ­å…³é”®è¯ï¼š" + styles[Math.floor(Math.random()*styles.length)] + "ï¼ˆå¯å¤åˆ¶åˆ°ç•™è¨€å¢™å½“æ‰“å¡ï¼‰";
  }else if(type==="luck"){
    resEl.textContent = "å¥½è¿ç­¾ï¼š" + luck[Math.floor(Math.random()*luck.length)];
  }else if(type==="draw"){
    const next = CARDS[Math.floor(Math.random()*CARDS.length)];
    openCard(next.id);
    return;
  }else if(type==="confetti"){
    confetti();
    resEl.textContent = "å·²æ”¾å½©çº¸ï½";
  }else if(type==="goto_mem"){
    closeModal();
    location.hash = "#games";
    setTimeout(()=> $("#startMemBtn").focus(), 150);
    resEl.textContent = "";
  }else if(type==="goto_wall"){
    closeModal();
    location.hash = "#wall";
    setTimeout(()=> $("#msgInput").focus(), 150);
  }else if(type==="copy_bless"){
    const txt = "æ„¿ä½ æˆ‘éƒ½èƒ½åœ¨å–œæ¬¢é‡Œä¿æŒçƒ­çˆ±ä¸æˆé•¿ã€‚";
    navigator.clipboard?.writeText(txt);
    resEl.textContent = "å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼š" + txt;
  }else if(type==="triple_like"){
    // hint: user can spam like button; keep separate action too
    resEl.textContent = "æç¤ºï¼šç”¨ä¸Šé¢çš„â€œâ¤ï¸ ç‚¹èµâ€è¿ç‚¹ 3 æ¬¡è§¦å‘å½©è›‹ï½";
  }else if(type==="beat"){
    beatStart(resEl);
  }else if(type==="focus"){
    focusChallenge(resEl);
  }else{
    resEl.textContent = "ï¼ˆè¿™ä¸ªæŒ‰é’®è¿˜æ²¡æ¥åŠŸèƒ½ï¼‰";
  }
}

/** ======================
 *  Draw & album
 *  ====================== */
function drawCard(){
  const c = CARDS[Math.floor(Math.random()*CARDS.length)];
  openCard(c.id);
}
$("#drawBtn").addEventListener("click", drawCard);
$("#drawBtn2").addEventListener("click", drawCard);

$("#openAlbumBtn").addEventListener("click", ()=>{
  const items = state.collected.map(id=> CARDS.find(c=>c.id===id)).filter(Boolean);
  const html = items.length ? `
    <div class="sub" style="margin-top:0">ä½ çš„æ”¶è—ï¼ˆ${items.length} å¼ ï¼‰</div>
    <div class="miniCards" style="margin-top:10px">
      ${items.map(c=>{
        const p = PHOTOS.find(x=>x.id===c.photo)||PHOTOS[0];
        return `
          <div class="mCard" style="grid-column:span 6" data-open="${c.id}">
            <div class="mImg" style="height:140px"><img loading="lazy" src="${p.img}" alt="${escapeHtml(c.title)}"></div>
            <div class="mBody">
              <div class="mTitle"><b>${c.emoji} ${escapeHtml(c.title)}</b><span class="mTag">â¤ï¸ ${cardLikes(c.id)}</span></div>
              <div class="mDesc">${escapeHtml(c.tag)}</div>
            </div>
          </div>
        `;
      }).join("")}
    </div>
  ` : `<div class="sub" style="margin-top:0">ä½ çš„å¡å†Œè¿˜æ˜¯ç©ºçš„ã€‚å»ç‚¹å‡ å¼ å¡æ”¶è—ä¸€ä¸‹å§ï½</div>`;

  openModal("æˆ‘çš„å¡å†Œ", `
    ${html}
    <div class="row" style="margin-top:12px">
      <button class="btn" type="button" id="exportAlbumBtn">ğŸ“¤ å¯¼å‡ºæ”¶è—ID</button>
      <button class="btn" type="button" id="closeAlbumBtn">å…³é—­</button>
    </div>
  `);

  setTimeout(()=>{
    $$(".mCard[data-open]").forEach(el=>{
      el.addEventListener("click", ()=> openCard(el.getAttribute("data-open")));
    });
    $("#exportAlbumBtn")?.addEventListener("click", ()=>{
      const txt = JSON.stringify(state.collected, null, 2);
      navigator.clipboard?.writeText(txt);
      $("#modalBody").querySelector(".sub").textContent = "å·²å¤åˆ¶æ”¶è— ID åˆ°å‰ªè´´æ¿ï¼ˆä¹Ÿå¯å½“å¤‡ä»½ï¼‰";
    });
    $("#closeAlbumBtn")?.addEventListener("click", closeModal);
  },0);
});

$("#clearAlbumBtn").addEventListener("click", ()=>{
  state.collected = [];
  save();
  renderQuickStats();
  renderCards();
  confetti();
});

/** ======================
 *  Confetti
 *  ====================== */
const confBox = $("#confetti");
function confetti(){
  const reduced = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;
  if(reduced) return;
  confBox.innerHTML = "";
  confBox.classList.add("show");
  const n = 80;
  for(let i=0;i<n;i++){
    const d = document.createElement("div");
    d.className = "c";
    const x = Math.random()*100;
    const x2 = x + (Math.random()*30 - 15);
    d.style.setProperty("--x", x+"vw");
    d.style.setProperty("--x2", x2+"vw");
    d.style.left = "0";
    d.style.top = "-10vh";
    d.style.animationDuration = (2.2 + Math.random()*1.6) + "s";
    d.style.animationDelay = (Math.random()*0.15) + "s";
    // no fixed colors? Use currentColor mix based on theme via HSL
    const hue = Math.floor(Math.random()*360);
    d.style.background = `hsl(${hue} 85% 60%)`;
    confBox.appendChild(d);
  }
  setTimeout(()=> confBox.classList.remove("show"), 3200);
}
$("#confettiBtn").addEventListener("click", confetti);

/** ======================
 *  Quiz (3 Q)
 *  ====================== */
const QUIZ = [
  {q:"ä½ æ›´æƒ³å…ˆç©å“ªä¸€ç§ï¼Ÿ", a:["æŠ½å¡æ”¶è—","è®°å¿†ç¿»ç‰Œ","ç•™è¨€æ‰“å¡"], right: 0},
  {q:"çœ‹åˆ°å–œæ¬¢çš„ç…§ç‰‡æ—¶ä½ ä¼šï¼Ÿ", a:["ç‚¹å¼€å¤§å›¾","ä¿å­˜æ¥æºé“¾æ¥","å†™ä¸€å¥æ„Ÿæƒ³"], right: 2},
  {q:"ä½ æ›´åçˆ±è¿™ä¸ªå°ç«™çš„å“ªç‚¹ï¼Ÿ", a:["è½»é‡ç¦»çº¿","äº’åŠ¨æŒ‰é’®å¤š","ç•Œé¢å¥½çœ‹"], right: 1}
];
function renderQuiz(){
  const box = $("#quiz");
  box.innerHTML = "";
  QUIZ.forEach((it, idx)=>{
    const div = document.createElement("div");
    div.style.marginBottom = "12px";
    div.innerHTML = `
      <div style="font-weight:800; margin-bottom:8px">${idx+1}. ${escapeHtml(it.q)}</div>
      <div class="row" style="gap:8px; align-items:stretch; flex-wrap:wrap">
        ${it.a.map((x,i)=>`<button class="pill" type="button" data-q="${idx}" data-a="${i}">ğŸ‘‰ ${escapeHtml(x)}</button>`).join("")}
      </div>
      <div class="sub" id="qa_${idx}" style="margin:8px 0 0"></div>
    `;
    box.appendChild(div);
  });
  box.insertAdjacentHTML("beforeend", `
    <div class="row" style="margin-top:8px">
      <button class="btn primary" id="quizFinishBtn" type="button">æäº¤å¹¶æ‹¿ç§°å·</button>
      <span class="chip" style="pointer-events:none">å¾—åˆ†ï¼š<b id="quizScore">0</b> / ${QUIZ.length}</span>
    </div>
    <div class="sub" id="quizResult" style="margin-top:10px"></div>
  `);

  const answers = new Array(QUIZ.length).fill(null);
  let score = 0;

  box.addEventListener("click", (e)=>{
    const btn = e.target.closest("button[data-q]");
    if(!btn) return;
    const q = +btn.getAttribute("data-q");
    const a = +btn.getAttribute("data-a");
    answers[q] = a;
    // feedback
    const ok = (a === QUIZ[q].right);
    $("#qa_"+q).textContent = ok ? "âœ… è¿™ä¸ªé€‰é¡¹å¾ˆç¬¦åˆâ€œå¨±ä¹å‘ç©æ³•â€ï½" : "ğŸŸ¡ ä¹Ÿä¸é”™ï¼Œä¸è¿‡æ¢ä¸ªé€‰é¡¹å¯èƒ½æ›´â€œäº’åŠ¨â€";
    // recompute score
    score = answers.reduce((s, aa, i)=> s + (aa===QUIZ[i].right ? 1 : 0), 0);
    $("#quizScore").textContent = score;
  });

  $("#quizFinishBtn").addEventListener("click", ()=>{
    if(answers.some(x=>x===null)){
      $("#quizResult").textContent = "å…ˆæŠŠ 3 é¢˜éƒ½ç‚¹å®Œå†æäº¤ï½";
      return;
    }
    const title =
      score===3 ? "ğŸ† äº’åŠ¨ç«™â€œå…¨å‹¤ç©å®¶â€" :
      score===2 ? "ğŸŒŸ å¿«ä¹æ°›å›´ç»„" :
      "ğŸ€ éšç¼˜ä½†çœŸè¯š";
    $("#quizResult").textContent = `ä½ çš„ç§°å·ï¼š${title}ï¼ˆå¾—åˆ† ${score}/${QUIZ.length}ï¼‰`;
    if(score>=2) confetti();
  });
}
renderQuiz();

/** ======================
 *  Memory game (6 pairs)
 *  ====================== */
let memTimer = null;
let memStart = 0;
let memOpen = [];
let memMatched = 0;

function buildMemDeck(){
  // pick 6 photos (all)
  const picks = [...PHOTOS].slice(0,6);
  const deck = [];
  picks.forEach(p=>{
    deck.push({k:p.id, img:p.img, title:p.title});
    deck.push({k:p.id, img:p.img, title:p.title});
  });
  // shuffle
  deck.sort(()=> Math.random()-0.5);
  return deck;
}

let memDeck = buildMemDeck();

function renderMem(){
  const grid = $("#memGrid");
  grid.innerHTML = "";
  $("#memMatch").textContent = memMatched;
  memDeck.forEach((c, idx)=>{
    const cell = document.createElement("div");
    cell.className = "card";
    cell.style.gridColumn = "span 4";
    cell.style.borderRadius = "16px";
    cell.style.cursor = "pointer";
    cell.style.userSelect = "none";
    cell.dataset.i = idx;
    cell.dataset.k = c.k;
    cell.dataset.open = "0";
    cell.dataset.done = "0";
    cell.innerHTML = `
      <div style="height: 96px; display:flex; align-items:center; justify-content:center; color:var(--muted); font-weight:800">
        ç‚¹å‡»ç¿»ç‰Œ
      </div>
    `;
    grid.appendChild(cell);
  });
}
renderMem();

function startMem(){
  memDeck = buildMemDeck();
  memOpen = [];
  memMatched = 0;
  renderMem();
  $("#memTime").textContent = "0.0";

  if(memTimer) clearInterval(memTimer);
  memStart = performance.now();
  memTimer = setInterval(()=>{
    const t = (performance.now()-memStart)/1000;
    $("#memTime").textContent = t.toFixed(1);
  }, 100);
}

function reveal(cell){
  const idx = +cell.dataset.i;
  const c = memDeck[idx];
  cell.dataset.open = "1";
  cell.innerHTML = `
    <div style="height:96px; overflow:hidden">
      <img src="${c.img}" alt="${escapeHtml(c.title)}" style="width:100%; height:100%; object-fit:cover; display:block">
    </div>
  `;
}

function hide(cell){
  cell.dataset.open = "0";
  cell.innerHTML = `
    <div style="height: 96px; display:flex; align-items:center; justify-content:center; color:var(--muted); font-weight:800">
      ç‚¹å‡»ç¿»ç‰Œ
    </div>
  `;
}

$("#memGrid").addEventListener("click", (e)=>{
  const cell = e.target.closest(".card");
  if(!cell || cell.dataset.done==="1") return;
  if(cell.dataset.open==="1") return;
  if(!memTimer) return; // not started yet

  reveal(cell);
  memOpen.push(cell);

  if(memOpen.length === 2){
    const [a,b] = memOpen;
    const same = a.dataset.k === b.dataset.k;
    if(same){
      a.dataset.done = "1";
      b.dataset.done = "1";
      memMatched++;
      $("#memMatch").textContent = memMatched;
      memOpen = [];
      if(memMatched >= 6){
        clearInterval(memTimer);
        memTimer = null;
        const t = (performance.now()-memStart)/1000;
        if(state.best == null || t < state.best){
          state.best = t;
          save();
          renderQuickStats();
        }
        confetti();
        openModal("æ­å–œé€šå…³ï¼", `
          <div style="font-weight:900; font-size:18px; margin-bottom:10px">âœ… ä½ å®Œæˆäº†å…¨éƒ¨åŒ¹é…</div>
          <div class="sub" style="margin-top:0">ç”¨æ—¶ï¼š<b>${t.toFixed(1)}s</b>ï¼ˆæœ€ä½³ï¼š${state.best.toFixed(1)}sï¼‰</div>
          <div class="row" style="margin-top:12px">
            <button class="btn primary" type="button" id="playAgainBtn">å†æ¥ä¸€å±€</button>
            <button class="btn" type="button" id="closeWinBtn">å…³é—­</button>
          </div>
        `);
        setTimeout(()=>{
          $("#playAgainBtn")?.addEventListener("click", ()=>{ closeModal(); startMem(); });
          $("#closeWinBtn")?.addEventListener("click", closeModal);
        },0);
      }
    }else{
      setTimeout(()=>{
        hide(a); hide(b);
        memOpen = [];
      }, 520);
    }
  }
});

$("#startMemBtn").addEventListener("click", startMem);
$("#restartMemBtn").addEventListener("click", startMem);

/** ======================
 *  Message wall
 *  ====================== */
const TOPICS = [
  "å†™ä¸€å¥ä½ æœ€å–œæ¬¢çš„â€œåšæŒâ€å…³é”®è¯ã€‚",
  "ç”¨ 10 ä¸ªå­—æ‰“å¡ä»Šå¤©çš„å¿ƒæƒ…ã€‚",
  "å¦‚æœæœ‰ä¸€å¼ å¡è¦é€ç»™æœªæ¥çš„è‡ªå·±ï¼Œä½ ä¼šå†™ä»€ä¹ˆï¼Ÿ",
  "å†™ä¸€å¥æ¸©æŸ”ä½†åšå®šçš„ç¥ç¦ã€‚",
  "ç”¨ä¸€ä¸ªemojiä¸²æˆä¸€å¥è¯ã€‚"
];

function uuid(){ return Math.random().toString(16).slice(2) + Date.now().toString(16); }

function renderMessages(){
  const list = $("#msgList");
  list.innerHTML = "";

  let msgs = [...state.messages];
  if(state.msgSort === "hot"){
    msgs.sort((a,b)=> (b.likes||0) - (a.likes||0) || b.ts - a.ts);
  }else{
    msgs.sort((a,b)=> b.ts - a.ts);
  }
  // pin first
  const pinned = msgs.filter(m=>m.pin);
  const rest = msgs.filter(m=>!m.pin);
  msgs = [...pinned, ...rest];

  if(!msgs.length){
    $("#emptyTip").style.display = "block";
    return;
  }
  $("#emptyTip").style.display = "none";

  msgs.forEach(m=>{
    const div = document.createElement("div");
    div.className = "msg";
    div.innerHTML = `
      <div class="msgTop">
        <div class="msgName">${escapeHtml(m.name || "åŒ¿å")} ${m.pin ? '<span class="chip" style="padding:3px 8px; font-size:11px; margin-left:6px; pointer-events:none">ğŸ“Œ ç½®é¡¶</span>' : ""}</div>
        <div class="msgTime">${fmtTime(m.ts)}</div>
      </div>
      <div class="msgText">${escapeHtml(m.text)}</div>
      <div class="msgActions">
        <button class="pill" type="button" data-like="${m.id}">â¤ï¸ ç‚¹èµ <b>${m.likes||0}</b></button>
        <button class="pill" type="button" data-pin="${m.id}">${m.pin ? "å–æ¶ˆç½®é¡¶" : "ğŸ“Œ ç½®é¡¶"}</button>
        <button class="pill" type="button" data-copy="${m.id}">ğŸ“‹ å¤åˆ¶</button>
        <button class="pill" type="button" data-del="${m.id}">ğŸ—‘ï¸ åˆ é™¤</button>
      </div>
    `;
    list.appendChild(div);
  });
}

function postMessage(){
  const name = $("#nameInput").value.trim().slice(0,20);
  const text = $("#msgInput").value.trim().slice(0,240);
  if(!text){
    $("#msgInput").focus();
    return;
  }
  state.messages.push({id:uuid(), name, text, ts:Date.now(), likes:0, pin:false});
  $("#msgInput").value = "";
  save();
  renderMessages();
  confetti();
}

$("#postBtn").addEventListener("click", postMessage);
$("#msgInput").addEventListener("keydown", (e)=>{
  if(e.ctrlKey && e.key==="Enter") postMessage();
});

$("#randomPromptBtn").addEventListener("click", ()=>{
  const t = TOPICS[Math.floor(Math.random()*TOPICS.length)];
  $("#msgInput").value = t + "\n";
  $("#msgInput").focus();
});

$("#msgList").addEventListener("click", (e)=>{
  const like = e.target.closest("[data-like]");
  const pin = e.target.closest("[data-pin]");
  const copy = e.target.closest("[data-copy]");
  const del  = e.target.closest("[data-del]");
  if(like){
    const id = like.getAttribute("data-like");
    const m = state.messages.find(x=>x.id===id);
    if(m){ m.likes = (m.likes||0)+1; save(); renderMessages(); }
  }else if(pin){
    const id = pin.getAttribute("data-pin");
    const m = state.messages.find(x=>x.id===id);
    if(m){ m.pin = !m.pin; save(); renderMessages(); }
  }else if(copy){
    const id = copy.getAttribute("data-copy");
    const m = state.messages.find(x=>x.id===id);
    if(m){ navigator.clipboard?.writeText(m.text); }
  }else if(del){
    const id = del.getAttribute("data-del");
    state.messages = state.messages.filter(x=>x.id!==id);
    save(); renderMessages();
  }
});

$("#sortHotBtn").addEventListener("click", ()=>{ state.msgSort="hot"; save(); renderMessages(); });
$("#sortNewBtn").addEventListener("click", ()=>{ state.msgSort="new"; save(); renderMessages(); });
$("#clearMsgBtn").addEventListener("click", ()=>{
  state.messages = [];
  save();
  renderMessages();
});

renderMessages();

/** ======================
 *  Reset
 *  ====================== */
$("#resetGamesBtn").addEventListener("click", ()=>{
  state.best = null;
  save();
  renderQuickStats();
  confetti();
});

/** ======================
 *  Fun: Beat & Focus
 *  ====================== */
let audioCtx = null;
function beep(freq=440, dur=0.08){
  const reduced = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;
  if(reduced) return;
  try{
    audioCtx = audioCtx || new (window.AudioContext || window.webkitAudioContext)();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.frequency.value = freq;
    o.type = "sine";
    g.gain.value = 0.04;
    o.connect(g); g.connect(audioCtx.destination);
    o.start();
    setTimeout(()=>{ o.stop(); }, dur*1000);
  }catch(e){}
}

function beatStart(resEl){
  resEl.innerHTML = `
    <div class="sub" style="margin-top:0">èŠ‚å¥æŒ‘æˆ˜ï¼šçœ‹åˆ°â€œâ—â€å°±ç‚¹æŒ‰é’®ï¼ˆ10 æ¬¡ï¼‰ã€‚</div>
    <div class="row" style="margin-top:8px">
      <button class="btn primary" type="button" id="tapBtn">â— ç‚¹æˆ‘</button>
      <span class="chip" style="pointer-events:none">è¿å‡»ï¼š<b id="tapN">0</b>/10</span>
    </div>
  `;
  let n = 0;
  const tapBtn = $("#tapBtn");
  const tapN = $("#tapN");
  tapBtn.addEventListener("click", ()=>{
    n++;
    tapN.textContent = n;
    beep(520 + n*10, 0.06);
    if(n>=10){
      confetti();
      resEl.innerHTML = "âœ… å®Œæˆï¼è¿å‡» 10/10ï¼Œä»Šå¤©çš„ä½ èŠ‚å¥å¾ˆç¨³ï½";
    }
  });
}

function focusChallenge(resEl){
  resEl.innerHTML = `
    <div class="sub" style="margin-top:0">ä¸“æ³¨æŒ‘æˆ˜ï¼š10 ç§’å†…æŠŠå°ç‚¹ç‚¹â€œè·Ÿä½â€å¹¶ç‚¹ 10 æ¬¡ã€‚</div>
    <div style="position:relative; height:140px; border:1px solid var(--line); border-radius:16px; overflow:hidden; background: color-mix(in srgb, var(--card) 92%, transparent)">
      <div id="dot" style="position:absolute; width:14px; height:14px; border-radius:999px; background: var(--brand); left:20px; top:40px"></div>
    </div>
    <div class="row" style="margin-top:10px">
      <button class="btn primary" type="button" id="focusStartBtn">å¼€å§‹</button>
      <span class="chip" style="pointer-events:none">ç‚¹å‡»ï¼š<b id="dotN">0</b>/10</span>
      <span class="chip" style="pointer-events:none">å‰©ä½™ï¼š<b id="dotT">10</b>s</span>
    </div>
  `;
  const dot = $("#dot");
  const startBtn = $("#focusStartBtn");
  const dotN = $("#dotN");
  const dotT = $("#dotT");

  let running = false, clicks = 0, t=10, timer=null, mover=null;
  dot.addEventListener("click", ()=>{
    if(!running) return;
    clicks++; dotN.textContent = clicks;
    beep(660, 0.05);
    if(clicks>=10){
      running=false;
      clearInterval(timer); clearInterval(mover);
      confetti();
      resEl.innerHTML = "ğŸ† ä¸“æ³¨æŒ‘æˆ˜æˆåŠŸï¼ä½ å¾ˆç¨³ã€‚";
    }
  });

  startBtn.addEventListener("click", ()=>{
    if(running) return;
    running=true; clicks=0; t=10;
    dotN.textContent="0"; dotT.textContent="10";
    // move dot
    mover = setInterval(()=>{
      const x = 10 + Math.random()*85;
      const y = 10 + Math.random()*75;
      dot.style.left = x + "%";
      dot.style.top = y + "%";
    }, 550);
    timer = setInterval(()=>{
      t--;
      dotT.textContent = t;
      if(t<=0){
        running=false;
        clearInterval(timer); clearInterval(mover);
        resEl.innerHTML = `â±ï¸ æ—¶é—´åˆ°ï¼ä½ ç‚¹äº† ${clicks}/10 æ¬¡ã€‚å†æ¥ä¸€æ¬¡ä¸€å®šè¡Œï½`;
      }
    }, 1000);
  });
}

/** ======================
 *  Hook: update stats on load
 *  ====================== */
window.addEventListener("load", ()=>{
  renderQuickStats();
});
</script>
</body>
</html>
